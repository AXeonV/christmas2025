<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Christmas Tree</title><style>body{margin:0;background:radial-gradient(circle at 20% 20%,#1f2836 0%,#101218 40%,#0a0b10 100%);color:#e9eef5;overflow:hidden}canvas{display:block;width:100vw;height:100vh;touch-action:none;}</style></head><body><canvas id="canvas"></canvas><script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.6/dat.gui.min.js"></script><script>window.CGL=window.CGL||{},window.CGL.colorConvert=function(){const t=document.createElement("canvas");t.height=1,t.width=1;const a=t.getContext("2d");return{mixBlendColors:function(t,e,o,n){a.clearRect(0,0,1,1),a.fillStyle="rgba(0, 0, 0, 0)",a.globalAlpha=1,a.globalCompositeOperation="source-over",a.fillStyle=t,a.fillRect(0,0,1,1),a.globalAlpha=o,a.globalCompositeOperation=n||"source-over",a.fillStyle=e,a.fillRect(0,0,1,1);let[i,r,l,s]=a.getImageData(0,0,1,1).data;return s/=255,`rgba(${i},${r},${l},${s})`},opacity:function(t,e){a.clearRect(0,0,1,1),a.fillStyle="rgba(0, 0, 0, 0)",a.globalAlpha=e,a.globalCompositeOperation="source-over",a.fillStyle=t,a.fillRect(0,0,1,1);let[o,n,i,r]=a.getImageData(0,0,1,1).data;return r/=255,`rgba(${o},${n},${i},${r})`}}}();let settings={background:"#111",rotationX:30,treeShape:"linear"},chains=[{bulbRadius:2,bulbsCount:100,endColor:"#FFC",glowOffset:0,opacity:1,startAngle:0,startColor:"#FFC",turnsCount:14},{bulbRadius:50,bulbsCount:20,endColor:"#0FF",glowOffset:0,opacity:.3,startAngle:120,startColor:"#FF0",turnsCount:3},{bulbRadius:12,bulbsCount:50,endColor:"#FF0",glowOffset:0,opacity:.68,startAngle:240,startColor:"#0FF",turnsCount:-3}];const pixelRatio=window.devicePixelRatio,canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");let gui=null,guiFirstFolder=null,guiLastFolder=null,rotationZ=0;const easingMap={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:(4-2*t)*t-1,easeInCubic:t=>t*t*t};function getRandomChain(){return{bulbsCount:Math.round(90*Math.random()+10),bulbRadius:Math.round(19*Math.random()+1),glowOffset:Math.random()<.5?0:Math.round(10*Math.random()+10),turnsCount:Math.round(7*Math.random()+3)*(Math.random()<.5?-1:1),startAngle:Math.round(360*Math.random()),startColor:"#FF0",endColor:"#0FF",opacity:Math.round(40*Math.random()+60)/100}}const guiMethods={"ADD CHAIN":()=>{chains.push(getRandomChain()),updateDatGui(),guiLastFolder.open()},"REMOVE CHAIN":null,removeChain:()=>{const t=guiMethods["REMOVE CHAIN"];Number.isNaN(parseInt(t))||(chains.splice(t,1),guiMethods["REMOVE CHAIN"]=null,updateDatGui())}};function updateDatGui(){gui&&gui.destroy(),gui=new dat.GUI,chains.forEach((t,a)=>{const e=gui.addFolder("Chain "+(a+1));e.add(chains[a],"bulbsCount",10,500,1),e.add(chains[a],"bulbRadius",1,100,1),e.add(chains[a],"glowOffset",0,100,1),e.add(chains[a],"turnsCount",-50,50,1),e.add(chains[a],"startAngle",0,360,1),e.addColor(chains[a],"startColor"),e.addColor(chains[a],"endColor"),e.add(chains[a],"opacity",0,1,.01),0===a?guiFirstFolder=e:a===chains.length-1&&(guiLastFolder=e)});let t={};chains.forEach((a,e)=>t[`Chain ${e+1}`]=e);const a=gui.addFolder("Options");return a.addColor(settings,"background"),a.add(settings,"treeShape",{linear:"linear",easeInQuad:"easeInQuad",easeOutQuad:"easeOutQuad",easeInOutQuad:"easeInOutQuad",easeInCubic:"easeInCubic"}),a.add(guiMethods,"ADD CHAIN"),a.add(guiMethods,"REMOVE CHAIN",t).onChange(guiMethods.removeChain),a.open(),gui}function updateScene(){let{innerWidth:t,innerHeight:a}=window;const e=settings.rotationX/180*Math.PI,o=.8*Math.min(t,a),n=.3*o,i={x:t/2,y:a/2+o/2*Math.cos(e)-n/2*Math.sin(e)};return ctx.canvas.width=t*pixelRatio,ctx.canvas.height=a*pixelRatio,ctx.scale(pixelRatio,pixelRatio),ctx.fillStyle=settings.background,ctx.rect(0,0,t,a),ctx.fill(),ctx.lineWidth=1.1,{tiltAngle:e,treeHeight:o,baseRadius:n,baseCenter:i}}function renderChain(t,a){for(let e=0;e<t.bulbsCount;e++){let o=e/(t.bulbsCount-1);o=Math.pow(o,Math.sqrt(o)+1);const n=o*t.turnsCount%1,i=easingMap[settings.treeShape]||easingMap.linear,r=a.baseRadius*(1-i(o)),l=(360*n+t.startAngle+rotationZ)/180*Math.PI%(2*Math.PI),s=Math.min(1,Math.max(0,Math.cos(l))+.2),d=a.baseCenter.x+Math.sin(l)*r,c=a.baseCenter.y-o*a.treeHeight*Math.sin((90-settings.rotationX)/180*Math.PI)+r*Math.sin(a.tiltAngle)*Math.cos(l),u=t.bulbRadius*a.treeHeight/1e3,h=(t.bulbRadius+t.glowOffset)*a.treeHeight/1e3,g=CGL.colorConvert.opacity(CGL.colorConvert.mixBlendColors(t.startColor,t.endColor,o),s);if(ctx.globalAlpha=t.opacity,t.glowOffset>0){const t=ctx.createRadialGradient(d,c,u,d,c,h);t.addColorStop(0,CGL.colorConvert.opacity(CGL.colorConvert.mixBlendColors(g,"#fff",.3),.5)),t.addColorStop(.25,CGL.colorConvert.opacity(g,.6)),t.addColorStop(.5,CGL.colorConvert.opacity(g,.3)),t.addColorStop(.75,CGL.colorConvert.opacity(g,.125)),t.addColorStop(1,CGL.colorConvert.opacity(g,0)),ctx.fillStyle=t,ctx.beginPath(),ctx.arc(d,c,h,0,2*Math.PI),ctx.fill()}ctx.fillStyle=g,ctx.beginPath(),ctx.arc(d,c,u,0,2*Math.PI),ctx.fill()}}function render(){const t=updateScene();chains.forEach(a=>renderChain(a,t))}updateDatGui(),guiFirstFolder.open();let isPointerDown=!1;const dragStart={x:0,y:0,rotX:0,rotZ:0},clampRotationX=t=>Math.min(75,Math.max(0,t));function updateRotationFromDrag(t){const a=window.innerHeight||1,e=window.innerWidth||1,o=(t.clientX-dragStart.x)/e*360,n=(t.clientY-dragStart.y)/a*75;settings.rotationX=clampRotationX(dragStart.rotX+n),rotationZ=dragStart.rotZ+o,render()}function rotate(){isPointerDown||(rotationZ=(rotationZ-1)%360),render(),window.requestAnimationFrame(rotate)}canvas.addEventListener("pointerdown",t=>{isPointerDown=!0,dragStart.x=t.clientX,dragStart.y=t.clientY,dragStart.rotX=settings.rotationX,dragStart.rotZ=rotationZ,canvas.setPointerCapture(t.pointerId)}),canvas.addEventListener("pointermove",t=>{isPointerDown&&updateRotationFromDrag(t)}),canvas.addEventListener("pointerup",t=>{isPointerDown=!1,canvas.releasePointerCapture(t.pointerId)}),canvas.addEventListener("pointercancel",()=>{isPointerDown=!1}),rotate(),window.addEventListener("resize",render),window.addEventListener("orientationchange",render);</script></body></html>